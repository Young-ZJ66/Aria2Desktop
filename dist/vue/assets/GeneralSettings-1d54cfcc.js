import{d as O,K as P,r as v,a as M,j as $,L as G,g as W,l as c,y as J,u as _,f as F,k as l,m as a,e as m,B as K,o as b,p as h,E as r,A as Q,i as q}from"./index-119c2593.js";const H={class:"general-settings"},X=O({__name:"GeneralSettings",setup(Y){const n=P(),C=v(),y=v(!1),g=v(!1),f=v(""),o=M({language:"zh-CN",theme:"light",refreshInterval:1e3,autoConnect:!0,minimizeToTray:!0,ui:{showStatusBar:!0,showToolbar:!0,taskListColumns:["name","size","progress","status","speed"],defaultView:"downloading"}});$(()=>n.settings,t=>{Object.assign(o,{language:t.language,theme:t.theme,refreshInterval:t.refreshInterval,autoConnect:t.autoConnect,minimizeToTray:t.minimizeToTray,ui:{...t.ui}})},{immediate:!0,deep:!0});function V(){Object.assign(o,{language:n.settings.language,theme:n.settings.theme,refreshInterval:n.settings.refreshInterval,autoConnect:n.settings.autoConnect,minimizeToTray:n.settings.minimizeToTray,ui:{...n.settings.ui}})}G(async()=>{await n.initialize()});async function k(){try{await n.updateSetting("refreshInterval",o.refreshInterval),r.success("刷新间隔已更新")}catch(t){console.error("Refresh interval change error:",t),r.error("刷新间隔更新失败："+(t instanceof Error?t.message:"未知错误"))}}async function E(){try{await n.updateSetting("autoConnect",o.autoConnect),r.success(o.autoConnect?"已启用启动时自动连接":"已禁用启动时自动连接")}catch(t){console.error("Auto connect change error:",t),r.error("自动连接设置失败："+(t instanceof Error?t.message:"未知错误"))}}async function I(){var t;try{await Q.confirm("确定要重置所有设置为默认值吗？此操作不可撤销。","确认重置设置",{confirmButtonText:"确定重置",cancelButtonText:"取消",type:"warning"}),await n.resetSettings(),V(),n.applyTheme(),(t=window.electronAPI)!=null&&t.setTrayEnabled&&await window.electronAPI.setTrayEnabled(n.settings.minimizeToTray),r.success("设置已重置为默认值")}catch(e){e!=="cancel"&&(console.error("Reset settings error:",e),r.error("重置设置失败："+(e instanceof Error?e.message:"未知错误")))}}function x(){try{const t=n.exportSettings(),e=new Blob([t],{type:"application/json"}),s=URL.createObjectURL(e),u=document.createElement("a");u.href=s,u.download=`aria2-desktop-settings-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(s),r.success("设置已导出")}catch{r.error("导出设置失败")}}async function z(){if(!f.value.trim()){r.warning("请输入设置内容");return}y.value=!0;try{await n.importSettings(f.value),g.value=!1,f.value="",r.success("设置已导入")}catch(t){r.error("导入设置失败："+(t instanceof Error?t.message:"未知错误"))}finally{y.value=!1}}async function S(){try{await L(o.theme),await n.updateSetting("theme",o.theme),r.success("主题已切换并保存")}catch(t){console.error("Theme change error:",t),r.error("主题切换失败："+(t instanceof Error?t.message:"未知错误"))}}async function L(t){var s;const e=t==="dark"||t==="auto"&&window.matchMedia("(prefers-color-scheme: dark)").matches;if(document.documentElement.classList.toggle("dark",e),document.documentElement.setAttribute("data-theme",e?"dark":"light"),(s=window.electronAPI)!=null&&s.setWindowTheme)try{await window.electronAPI.setWindowTheme(e),console.log(`窗口主题已更新为: ${e?"dark":"light"}`)}catch(u){console.error("更新窗口主题失败:",u)}if(t==="auto"){const u=window.matchMedia("(prefers-color-scheme: dark)"),d=()=>{n.settings.theme==="auto"&&n.applyTheme()};u.removeEventListener("change",d),u.addEventListener("change",d)}}async function A(){try{await n.updateSetting("language",o.language),r.info("语言设置已保存，将在重启应用后生效")}catch(t){console.error("Language change error:",t),r.error("语言设置失败："+(t instanceof Error?t.message:"未知错误"))}}async function U(){var t;try{(t=window.electronAPI)!=null&&t.setTrayEnabled&&await window.electronAPI.setTrayEnabled(o.minimizeToTray),await n.updateSetting("minimizeToTray",o.minimizeToTray),r.success(o.minimizeToTray?"已启用系统托盘":"已禁用系统托盘")}catch(e){console.error("Tray setting change error:",e),r.error("托盘设置失败："+(e instanceof Error?e.message:"未知错误"))}}return(t,e)=>{const s=m("el-option"),u=m("el-select"),d=m("el-form-item"),w=m("el-switch"),B=m("el-divider"),p=m("el-button"),R=m("el-space"),T=m("el-form"),j=m("el-input"),D=m("el-dialog"),N=K("loading");return b(),W("div",H,[e[17]||(e[17]=c("div",{class:"settings-header"},[c("h2",null,"常规设置"),c("p",{class:"settings-description"},"配置应用程序的基本行为和外观")],-1)),J((b(),F(T,{ref_key:"formRef",ref:C,model:o,"label-width":"150px",style:{"max-width":"600px"}},{default:l(()=>[a(d,{label:"语言"},{default:l(()=>[a(u,{modelValue:o.language,"onUpdate:modelValue":e[0]||(e[0]=i=>o.language=i),style:{width:"100%"},onChange:A},{default:l(()=>[a(s,{label:"简体中文",value:"zh-CN"}),a(s,{label:"繁体中文",value:"zh-TW"}),a(s,{label:"English",value:"en"})]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"主题"},{default:l(()=>[a(u,{modelValue:o.theme,"onUpdate:modelValue":e[1]||(e[1]=i=>o.theme=i),style:{width:"100%"},onChange:S},{default:l(()=>[a(s,{label:"浅色主题",value:"light"}),a(s,{label:"深色主题",value:"dark"}),a(s,{label:"跟随系统",value:"auto"})]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"自动刷新间隔"},{default:l(()=>[a(u,{modelValue:o.refreshInterval,"onUpdate:modelValue":e[2]||(e[2]=i=>o.refreshInterval=i),style:{width:"100%"},onChange:k},{default:l(()=>[a(s,{label:"1秒",value:1e3}),a(s,{label:"2秒",value:2e3}),a(s,{label:"5秒",value:5e3}),a(s,{label:"10秒",value:1e4})]),_:1},8,["modelValue"]),e[9]||(e[9]=c("div",{class:"form-tip"},"设置任务列表和统计信息的自动刷新频率",-1))]),_:1}),a(d,{label:"启动时自动连接"},{default:l(()=>[a(w,{modelValue:o.autoConnect,"onUpdate:modelValue":e[3]||(e[3]=i=>o.autoConnect=i),onChange:E},null,8,["modelValue"]),e[10]||(e[10]=c("div",{class:"form-tip"},"应用启动时自动连接到上次使用的 Aria2 服务器",-1))]),_:1}),a(d,{label:"最小化到系统托盘"},{default:l(()=>[a(w,{modelValue:o.minimizeToTray,"onUpdate:modelValue":e[4]||(e[4]=i=>o.minimizeToTray=i),onChange:U},null,8,["modelValue"]),e[11]||(e[11]=c("div",{class:"form-tip"},"关闭窗口时最小化到系统托盘而不是退出程序",-1))]),_:1}),a(B),a(d,null,{default:l(()=>[a(R,null,{default:l(()=>[a(p,{onClick:I,disabled:_(n).isLoading},{default:l(()=>[...e[12]||(e[12]=[h(" 重置设置 ",-1)])]),_:1},8,["disabled"]),a(p,{onClick:x},{default:l(()=>[...e[13]||(e[13]=[h(" 导出设置 ",-1)])]),_:1}),a(p,{onClick:e[5]||(e[5]=i=>g.value=!0)},{default:l(()=>[...e[14]||(e[14]=[h(" 导入设置 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])),[[N,_(n).isLoading]]),a(D,{modelValue:g.value,"onUpdate:modelValue":e[8]||(e[8]=i=>g.value=i),title:"导入设置",width:"500px"},{footer:l(()=>[a(p,{onClick:e[7]||(e[7]=i=>g.value=!1)},{default:l(()=>[...e[15]||(e[15]=[h("取消",-1)])]),_:1}),a(p,{type:"primary",onClick:z,loading:y.value},{default:l(()=>[...e[16]||(e[16]=[h(" 导入 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(T,null,{default:l(()=>[a(d,{label:"设置文件"},{default:l(()=>[a(j,{modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=i=>f.value=i),type:"textarea",rows:10,placeholder:"请粘贴设置 JSON 内容..."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});const ee=q(X,[["__scopeId","data-v-d2a481e7"]]);export{ee as default};
