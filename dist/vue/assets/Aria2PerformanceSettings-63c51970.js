import{d as P,x as E,r as w,a as I,L as N,E as u,g as T,l as i,u as p,f as _,v as K,y as j,k as t,e as d,B as q,o as C,m as a,p as y,A as F,i as G}from"./index-aa3933e3.js";const $={class:"performance-settings"},z=P({__name:"Aria2PerformanceSettings",setup(H){const m=E(),f=w(),c=w(!1),v=w(!1),l=I({maxOverallDownloadLimit:"0",maxOverallUploadLimit:"0",maxUploadLimit:"0",diskCache:16,fileAllocation:"prealloc",maxDownloadResult:1e3,realtimeChunkChecksum:!0,uriSelector:"feedback",eventPoll:"epoll",enableMmap:!1}),D={diskCache:[{type:"number",min:0,max:1024,message:"值必须在0-1024之间",trigger:"blur"}],maxDownloadResult:[{type:"number",min:0,max:1e4,message:"值必须在0-10000之间",trigger:"blur"}]};N(()=>{m.isConnected&&V()});async function V(){if(!m.isConnected){u.warning("请先连接到 Aria2 服务器");return}c.value=!0;try{const o=await m.getGlobalOptions();if(o&&typeof o=="object"){l.maxOverallDownloadLimit=o["max-overall-download-limit"]||"0",l.maxOverallUploadLimit=o["max-overall-upload-limit"]||"0",l.maxUploadLimit=o["max-upload-limit"]||"0";const e=o["disk-cache"]||"16M";l.diskCache=parseInt(e.replace(/[^0-9]/g,""))||16,l.fileAllocation=o["file-allocation"]||"prealloc",l.maxDownloadResult=parseInt(o["max-download-result"]||"1000"),l.realtimeChunkChecksum=o["realtime-chunk-checksum"]!=="false",l.uriSelector=o["uri-selector"]||"feedback",l.eventPoll=o["event-poll"]||"epoll",l.enableMmap=o["enable-mmap"]==="true",u.success("性能设置加载成功")}}catch(o){const e=o instanceof Error?o.message:"未知错误";u.error(`加载性能设置失败: ${e}`),console.error("Failed to load performance settings:",o)}finally{c.value=!1}}async function S(){if(f.value){try{await f.value.validate()}catch{return}if(!m.isConnected){u.warning("请先连接到 Aria2 服务器");return}v.value=!0;try{const o={"max-overall-download-limit":l.maxOverallDownloadLimit,"max-overall-upload-limit":l.maxOverallUploadLimit,"max-upload-limit":l.maxUploadLimit,"disk-cache":l.diskCache.toString()+"M","file-allocation":l.fileAllocation,"max-download-result":l.maxDownloadResult.toString(),"realtime-chunk-checksum":l.realtimeChunkChecksum?"true":"false","uri-selector":l.uriSelector,"event-poll":l.eventPoll,"enable-mmap":l.enableMmap?"true":"false"};await m.changeGlobalOptions(o),u.success("性能设置已保存")}catch(o){u.error("保存性能设置失败"),console.error("Failed to save performance settings:",o)}finally{v.value=!1}}}async function O(){try{await F.confirm("确定要恢复为默认性能设置吗？","确认恢复",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),Object.assign(l,{maxOverallDownloadLimit:"0",maxOverallUploadLimit:"0",maxUploadLimit:"0",diskCache:16,fileAllocation:"prealloc",maxDownloadResult:1e3,realtimeChunkChecksum:!0,uriSelector:"feedback",eventPoll:"epoll",enableMmap:!1}),u.success("已恢复为默认性能设置")}catch{}}return(o,e)=>{const A=d("el-alert"),x=d("el-input"),s=d("el-form-item"),b=d("el-card"),U=d("el-input-number"),r=d("el-option"),g=d("el-select"),L=d("el-switch"),k=d("el-button"),M=d("el-space"),B=d("el-form"),R=q("loading");return C(),T("div",$,[e[30]||(e[30]=i("div",{class:"settings-header"},[i("h2",null,"性能与限制"),i("p",{class:"settings-description"},"配置速度限制、磁盘缓存和性能优化参数")],-1)),p(m).isConnected?K("",!0):(C(),_(A,{key:0,title:"未连接到 Aria2 服务器",description:"请先连接到 Aria2 服务器才能修改设置",type:"warning",closable:!1,style:{"margin-bottom":"20px"}})),j((C(),_(B,{ref_key:"formRef",ref:f,model:l,rules:D,"label-width":"200px",style:{"max-width":"800px"},disabled:!p(m).isConnected},{default:t(()=>[a(b,{class:"setting-group"},{header:t(()=>[...e[10]||(e[10]=[i("span",{class:"group-title"},"速度限制",-1)])]),default:t(()=>[a(s,{label:"全局最大下载速度",prop:"maxOverallDownloadLimit"},{default:t(()=>[a(x,{modelValue:l.maxOverallDownloadLimit,"onUpdate:modelValue":e[0]||(e[0]=n=>l.maxOverallDownloadLimit=n),placeholder:"0 表示无限制",style:{width:"200px"}},null,8,["modelValue"]),e[11]||(e[11]=i("span",{style:{"margin-left":"8px"}},"KB/s",-1)),e[12]||(e[12]=i("div",{class:"form-tip"},"全局最大下载速度限制",-1))]),_:1}),a(s,{label:"全局最大上传速度",prop:"maxOverallUploadLimit"},{default:t(()=>[a(x,{modelValue:l.maxOverallUploadLimit,"onUpdate:modelValue":e[1]||(e[1]=n=>l.maxOverallUploadLimit=n),placeholder:"0 表示无限制",style:{width:"200px"}},null,8,["modelValue"]),e[13]||(e[13]=i("span",{style:{"margin-left":"8px"}},"KB/s",-1)),e[14]||(e[14]=i("div",{class:"form-tip"},"全局最大上传速度限制",-1))]),_:1}),a(s,{label:"单任务最大上传速度",prop:"maxUploadLimit"},{default:t(()=>[a(x,{modelValue:l.maxUploadLimit,"onUpdate:modelValue":e[2]||(e[2]=n=>l.maxUploadLimit=n),placeholder:"0 表示无限制",style:{width:"200px"}},null,8,["modelValue"]),e[15]||(e[15]=i("span",{style:{"margin-left":"8px"}},"KB/s",-1)),e[16]||(e[16]=i("div",{class:"form-tip"},"单个任务的最大上传速度限制",-1))]),_:1})]),_:1}),a(b,{class:"setting-group"},{header:t(()=>[...e[17]||(e[17]=[i("span",{class:"group-title"},"磁盘和内存",-1)])]),default:t(()=>[a(s,{label:"磁盘缓存",prop:"diskCache"},{default:t(()=>[a(U,{modelValue:l.diskCache,"onUpdate:modelValue":e[3]||(e[3]=n=>l.diskCache=n),min:0,max:1024,style:{width:"200px"}},null,8,["modelValue"]),e[18]||(e[18]=i("span",{style:{"margin-left":"8px"}},"MB",-1)),e[19]||(e[19]=i("div",{class:"form-tip"},"磁盘缓存大小，0 表示禁用缓存",-1))]),_:1}),a(s,{label:"文件预分配",prop:"fileAllocation"},{default:t(()=>[a(g,{modelValue:l.fileAllocation,"onUpdate:modelValue":e[4]||(e[4]=n=>l.fileAllocation=n),style:{width:"200px"}},{default:t(()=>[a(r,{label:"无预分配",value:"none"}),a(r,{label:"预分配",value:"prealloc"}),a(r,{label:"快速预分配",value:"falloc"})]),_:1},8,["modelValue"]),e[20]||(e[20]=i("div",{class:"form-tip"},"文件预分配方法，可提高磁盘性能",-1))]),_:1}),a(s,{label:"最大下载结果",prop:"maxDownloadResult"},{default:t(()=>[a(U,{modelValue:l.maxDownloadResult,"onUpdate:modelValue":e[5]||(e[5]=n=>l.maxDownloadResult=n),min:0,max:1e4,style:{width:"200px"}},null,8,["modelValue"]),e[21]||(e[21]=i("div",{class:"form-tip"},"保存的最大下载结果数量",-1))]),_:1})]),_:1}),a(b,{class:"setting-group"},{header:t(()=>[...e[22]||(e[22]=[i("span",{class:"group-title"},"性能优化",-1)])]),default:t(()=>[a(s,{label:"实时检查数据块",prop:"realtimeChunkChecksum"},{default:t(()=>[a(L,{modelValue:l.realtimeChunkChecksum,"onUpdate:modelValue":e[6]||(e[6]=n=>l.realtimeChunkChecksum=n)},null,8,["modelValue"]),e[23]||(e[23]=i("div",{class:"form-tip"},"实时检查下载数据块的校验和",-1))]),_:1}),a(s,{label:"URI 选择策略",prop:"uriSelector"},{default:t(()=>[a(g,{modelValue:l.uriSelector,"onUpdate:modelValue":e[7]||(e[7]=n=>l.uriSelector=n),style:{width:"200px"}},{default:t(()=>[a(r,{label:"反馈选择",value:"feedback"}),a(r,{label:"顺序选择",value:"inorder"}),a(r,{label:"自适应选择",value:"adaptive"})]),_:1},8,["modelValue"]),e[24]||(e[24]=i("div",{class:"form-tip"},"URI 选择策略，影响下载源的选择",-1))]),_:1}),a(s,{label:"事件轮询方法",prop:"eventPoll"},{default:t(()=>[a(g,{modelValue:l.eventPoll,"onUpdate:modelValue":e[8]||(e[8]=n=>l.eventPoll=n),style:{width:"200px"}},{default:t(()=>[a(r,{label:"epoll (Linux)",value:"epoll"}),a(r,{label:"kqueue (BSD)",value:"kqueue"}),a(r,{label:"port (Solaris)",value:"port"}),a(r,{label:"poll",value:"poll"}),a(r,{label:"select",value:"select"})]),_:1},8,["modelValue"]),e[25]||(e[25]=i("div",{class:"form-tip"},"系统事件轮询方法，影响网络性能",-1))]),_:1}),a(s,{label:"启用 mmap",prop:"enableMmap"},{default:t(()=>[a(L,{modelValue:l.enableMmap,"onUpdate:modelValue":e[9]||(e[9]=n=>l.enableMmap=n)},null,8,["modelValue"]),e[26]||(e[26]=i("div",{class:"form-tip"},"启用内存映射文件，可能提高性能",-1))]),_:1})]),_:1}),a(s,{style:{"margin-top":"24px"}},{default:t(()=>[a(M,null,{default:t(()=>[a(k,{type:"primary",onClick:S,loading:v.value,disabled:!p(m).isConnected},{default:t(()=>[...e[27]||(e[27]=[y(" 保存设置 ",-1)])]),_:1},8,["loading","disabled"]),a(k,{onClick:V,disabled:!p(m).isConnected},{default:t(()=>[...e[28]||(e[28]=[y(" 重新加载 ",-1)])]),_:1},8,["disabled"]),a(k,{onClick:O,disabled:!p(m).isConnected},{default:t(()=>[...e[29]||(e[29]=[y(" 恢复默认 ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["model","disabled"])),[[R,c.value]])])}}});const Q=G(z,[["__scopeId","data-v-eac35cb8"]]);export{Q as default};
