import{d as L,x as W,r as b,a as I,L as E,E as d,g as M,l as s,u as x,f as S,v as N,y as D,k as n,e as m,B as F,o as w,m as l,p as c,A as O,i as j}from"./index-aa3933e3.js";const G={class:"connection-settings"},R=L({__name:"Aria2ConnectionSettings",setup(H){const i=W(),f=b(),g=b(!1),P=b(!1),t=I({connectTimeout:60,timeout:60,maxTries:5,retryWait:0,maxConnectionPerServer:5,split:5,lowestSpeedLimit:"0",allProxy:"",allProxyUser:"",allProxyPasswd:"",noProxy:""}),C={connectTimeout:[{type:"number",min:1,max:600,message:"值必须在1-600之间",trigger:"blur"}],timeout:[{type:"number",min:1,max:600,message:"值必须在1-600之间",trigger:"blur"}],maxTries:[{type:"number",min:0,max:100,message:"值必须在0-100之间",trigger:"blur"}],retryWait:[{type:"number",min:0,max:600,message:"值必须在0-600之间",trigger:"blur"}],maxConnectionPerServer:[{type:"number",min:1,max:16,message:"值必须在1-16之间",trigger:"blur"}],split:[{type:"number",min:1,max:16,message:"值必须在1-16之间",trigger:"blur"}]};E(()=>{i.isConnected&&V()});async function V(){if(!i.isConnected){d.warning("请先连接到 Aria2 服务器");return}g.value=!0;try{const o=await i.getGlobalOptions();o&&typeof o=="object"&&(t.connectTimeout=parseInt(o["connect-timeout"]||"60"),t.timeout=parseInt(o.timeout||"60"),t.maxTries=parseInt(o["max-tries"]||"5"),t.retryWait=parseInt(o["retry-wait"]||"0"),t.maxConnectionPerServer=parseInt(o["max-connection-per-server"]||"5"),t.split=parseInt(o.split||"5"),t.lowestSpeedLimit=o["lowest-speed-limit"]||"0",t.allProxy=o["all-proxy"]||"",t.allProxyUser=o["all-proxy-user"]||"",t.allProxyPasswd=o["all-proxy-passwd"]||"",t.noProxy=o["no-proxy"]||"",d.success("连接设置加载成功"))}catch(o){const e=o instanceof Error?o.message:"未知错误";d.error(`加载连接设置失败: ${e}`),console.error("Failed to load connection settings:",o)}finally{g.value=!1}}async function T(){if(f.value){try{await f.value.validate()}catch{return}if(!i.isConnected){d.warning("请先连接到 Aria2 服务器");return}P.value=!0;try{const o={"connect-timeout":t.connectTimeout.toString(),timeout:t.timeout.toString(),"max-tries":t.maxTries.toString(),"retry-wait":t.retryWait.toString(),"max-connection-per-server":t.maxConnectionPerServer.toString(),split:t.split.toString(),"lowest-speed-limit":t.lowestSpeedLimit};t.allProxy&&(o["all-proxy"]=t.allProxy),t.allProxyUser&&(o["all-proxy-user"]=t.allProxyUser),t.allProxyPasswd&&(o["all-proxy-passwd"]=t.allProxyPasswd),t.noProxy&&(o["no-proxy"]=t.noProxy),await i.changeGlobalOptions(o),d.success("连接设置已保存")}catch(o){d.error("保存连接设置失败"),console.error("Failed to save connection settings:",o)}finally{P.value=!1}}}async function U(){try{await O.confirm("确定要恢复为默认连接设置吗？","确认恢复",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),Object.assign(t,{connectTimeout:60,timeout:60,maxTries:5,retryWait:0,maxConnectionPerServer:5,split:5,lowestSpeedLimit:"0",allProxy:"",allProxyUser:"",allProxyPasswd:"",noProxy:""}),d.success("已恢复为默认连接设置")}catch{}}return(o,e)=>{const k=m("el-alert"),p=m("el-input-number"),a=m("el-form-item"),y=m("el-card"),u=m("el-input"),v=m("el-button"),A=m("el-space"),B=m("el-form"),_=F("loading");return w(),M("div",G,[e[31]||(e[31]=s("div",{class:"settings-header"},[s("h2",null,"连接设置"),s("p",{class:"settings-description"},"配置连接、超时、重试和代理相关参数")],-1)),x(i).isConnected?N("",!0):(w(),S(k,{key:0,title:"未连接到 Aria2 服务器",description:"请先连接到 Aria2 服务器才能修改设置",type:"warning",closable:!1,style:{"margin-bottom":"20px"}})),D((w(),S(B,{ref_key:"formRef",ref:f,model:t,rules:C,"label-width":"200px",style:{"max-width":"800px"},disabled:!x(i).isConnected},{default:n(()=>[l(y,{class:"setting-group"},{header:n(()=>[...e[11]||(e[11]=[s("span",{class:"group-title"},"超时设置",-1)])]),default:n(()=>[l(a,{label:"连接超时",prop:"connectTimeout"},{default:n(()=>[l(p,{modelValue:t.connectTimeout,"onUpdate:modelValue":e[0]||(e[0]=r=>t.connectTimeout=r),min:1,max:600,style:{width:"200px"}},null,8,["modelValue"]),e[12]||(e[12]=s("span",{style:{"margin-left":"8px"}},"秒",-1)),e[13]||(e[13]=s("div",{class:"form-tip"},"建立连接的超时时间（1-600秒）",-1))]),_:1}),l(a,{label:"请求超时",prop:"timeout"},{default:n(()=>[l(p,{modelValue:t.timeout,"onUpdate:modelValue":e[1]||(e[1]=r=>t.timeout=r),min:1,max:600,style:{width:"200px"}},null,8,["modelValue"]),e[14]||(e[14]=s("span",{style:{"margin-left":"8px"}},"秒",-1)),e[15]||(e[15]=s("div",{class:"form-tip"},"HTTP/FTP 请求的超时时间（1-600秒）",-1))]),_:1})]),_:1}),l(y,{class:"setting-group"},{header:n(()=>[...e[16]||(e[16]=[s("span",{class:"group-title"},"重试设置",-1)])]),default:n(()=>[l(a,{label:"最大重试次数",prop:"maxTries"},{default:n(()=>[l(p,{modelValue:t.maxTries,"onUpdate:modelValue":e[2]||(e[2]=r=>t.maxTries=r),min:0,max:100,style:{width:"200px"}},null,8,["modelValue"]),e[17]||(e[17]=s("div",{class:"form-tip"},"连接失败时的最大重试次数（0表示不重试）",-1))]),_:1}),l(a,{label:"重试等待时间",prop:"retryWait"},{default:n(()=>[l(p,{modelValue:t.retryWait,"onUpdate:modelValue":e[3]||(e[3]=r=>t.retryWait=r),min:0,max:600,style:{width:"200px"}},null,8,["modelValue"]),e[18]||(e[18]=s("span",{style:{"margin-left":"8px"}},"秒",-1)),e[19]||(e[19]=s("div",{class:"form-tip"},"重试前的等待时间（0-600秒）",-1))]),_:1})]),_:1}),l(y,{class:"setting-group"},{header:n(()=>[...e[20]||(e[20]=[s("span",{class:"group-title"},"连接数限制",-1)])]),default:n(()=>[l(a,{label:"每服务器最大连接数",prop:"maxConnectionPerServer"},{default:n(()=>[l(p,{modelValue:t.maxConnectionPerServer,"onUpdate:modelValue":e[4]||(e[4]=r=>t.maxConnectionPerServer=r),min:1,max:16,style:{width:"200px"}},null,8,["modelValue"]),e[21]||(e[21]=s("div",{class:"form-tip"},"对单个服务器的最大连接数（1-16）",-1))]),_:1}),l(a,{label:"分片连接数",prop:"split"},{default:n(()=>[l(p,{modelValue:t.split,"onUpdate:modelValue":e[5]||(e[5]=r=>t.split=r),min:1,max:16,style:{width:"200px"}},null,8,["modelValue"]),e[22]||(e[22]=s("div",{class:"form-tip"},"每个文件的分片连接数（1-16）",-1))]),_:1}),l(a,{label:"最低下载速度",prop:"lowestSpeedLimit"},{default:n(()=>[l(u,{modelValue:t.lowestSpeedLimit,"onUpdate:modelValue":e[6]||(e[6]=r=>t.lowestSpeedLimit=r),placeholder:"0 表示无限制",style:{width:"200px"}},null,8,["modelValue"]),e[23]||(e[23]=s("span",{style:{"margin-left":"8px"}},"B/s",-1)),e[24]||(e[24]=s("div",{class:"form-tip"},"最低下载速度限制，低于此速度将重连",-1))]),_:1})]),_:1}),l(y,{class:"setting-group"},{header:n(()=>[...e[25]||(e[25]=[s("span",{class:"group-title"},"通用代理设置",-1)])]),default:n(()=>[l(a,{label:"全局代理"},{default:n(()=>[l(u,{modelValue:t.allProxy,"onUpdate:modelValue":e[7]||(e[7]=r=>t.allProxy=r),placeholder:"http://proxy.example.com:8080"},null,8,["modelValue"]),e[26]||(e[26]=s("div",{class:"form-tip"},"适用于所有协议的通用代理服务器",-1))]),_:1}),l(a,{label:"代理用户名"},{default:n(()=>[l(u,{modelValue:t.allProxyUser,"onUpdate:modelValue":e[8]||(e[8]=r=>t.allProxyUser=r),placeholder:"代理服务器用户名"},null,8,["modelValue"])]),_:1}),l(a,{label:"代理密码"},{default:n(()=>[l(u,{modelValue:t.allProxyPasswd,"onUpdate:modelValue":e[9]||(e[9]=r=>t.allProxyPasswd=r),type:"password",placeholder:"代理服务器密码","show-password":""},null,8,["modelValue"])]),_:1}),l(a,{label:"无代理主机"},{default:n(()=>[l(u,{modelValue:t.noProxy,"onUpdate:modelValue":e[10]||(e[10]=r=>t.noProxy=r),placeholder:"localhost,127.0.0.1,*.local"},null,8,["modelValue"]),e[27]||(e[27]=s("div",{class:"form-tip"},"不使用代理的主机列表，用逗号分隔",-1))]),_:1})]),_:1}),l(a,{style:{"margin-top":"24px"}},{default:n(()=>[l(A,null,{default:n(()=>[l(v,{type:"primary",onClick:T,loading:P.value,disabled:!x(i).isConnected},{default:n(()=>[...e[28]||(e[28]=[c(" 保存设置 ",-1)])]),_:1},8,["loading","disabled"]),l(v,{onClick:V,disabled:!x(i).isConnected},{default:n(()=>[...e[29]||(e[29]=[c(" 重新加载 ",-1)])]),_:1},8,["disabled"]),l(v,{onClick:U,disabled:!x(i).isConnected},{default:n(()=>[...e[30]||(e[30]=[c(" 恢复默认 ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["model","disabled"])),[[_,g.value]])])}}});const q=j(R,[["__scopeId","data-v-7f11c54f"]]);export{q as default};
