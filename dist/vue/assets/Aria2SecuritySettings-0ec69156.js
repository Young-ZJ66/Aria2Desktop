import{d as T,x as H,r as V,c as L,a as B,L as I,E as f,g as K,l as i,u as p,f as y,v as R,y as _,k as o,e as u,B as D,o as g,m as t,p as A,A as N,i as j}from"./index-0c5f6936.js";const G={class:"security-settings"},W=T({__name:"Aria2SecuritySettings",setup($){const n=H(),x=V(),k=V(!1),C=V(!1),w=L(()=>navigator.platform.toLowerCase().includes("win")),l=B({rpcSecret:"",rpcListenAll:!1,enableRpcForAll:!1,allowOverwrite:!1,autoFileRenaming:!0,forceSave:!1,fileAllocationMode:"644",checkIntegrity:!1,checksumCheck:!0,checksumAlgorithm:"sha-1",continueOnChecksumError:!1,checkCertificate:!0,caCertificate:"",certificate:"",privateKey:""});I(()=>{n.isConnected&&S()});async function S(){if(!n.isConnected){f.warning("请先连接到 Aria2 服务器");return}k.value=!0;try{const a=await n.getGlobalOptions();a&&typeof a=="object"&&(l.rpcSecret=a["rpc-secret"]||"",l.rpcListenAll=a["rpc-listen-all"]==="true",l.enableRpcForAll=a["enable-rpc"]==="true",l.allowOverwrite=a["allow-overwrite"]==="true",l.autoFileRenaming=a["auto-file-renaming"]!=="false",l.forceSave=a["force-save"]==="true",l.fileAllocationMode=a["file-allocation-mode"]||"644",l.checkIntegrity=a["check-integrity"]==="true",l.checksumCheck=a["checksum-check"]!=="false",l.checksumAlgorithm=a.checksum||"sha-1",l.continueOnChecksumError=a["continue-on-checksum-error"]==="true",l.checkCertificate=a["check-certificate"]!=="false",l.caCertificate=a["ca-certificate"]||"",l.certificate=a.certificate||"",l.privateKey=a["private-key"]||"",f.success("安全设置加载成功"))}catch(a){const e=a instanceof Error?a.message:"未知错误";f.error(`加载安全设置失败: ${e}`),console.error("Failed to load security settings:",a)}finally{k.value=!1}}async function O(){if(!n.isConnected){f.warning("请先连接到 Aria2 服务器");return}C.value=!0;try{const a={"rpc-listen-all":l.rpcListenAll?"true":"false","enable-rpc":l.enableRpcForAll?"true":"false","allow-overwrite":l.allowOverwrite?"true":"false","auto-file-renaming":l.autoFileRenaming?"true":"false","force-save":l.forceSave?"true":"false","check-integrity":l.checkIntegrity?"true":"false","checksum-check":l.checksumCheck?"true":"false",checksum:l.checksumAlgorithm,"continue-on-checksum-error":l.continueOnChecksumError?"true":"false","check-certificate":l.checkCertificate?"true":"false"};l.rpcSecret&&(a["rpc-secret"]=l.rpcSecret),l.fileAllocationMode&&!w.value&&(a["file-allocation-mode"]=l.fileAllocationMode),l.caCertificate&&(a["ca-certificate"]=l.caCertificate),l.certificate&&(a.certificate=l.certificate),l.privateKey&&(a["private-key"]=l.privateKey),await n.changeGlobalOptions(a),f.success("安全设置已保存")}catch(a){f.error("保存安全设置失败"),console.error("Failed to save security settings:",a)}finally{C.value=!1}}async function U(){try{await N.confirm("确定要恢复为默认安全设置吗？","确认恢复",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),Object.assign(l,{rpcSecret:"",rpcListenAll:!1,enableRpcForAll:!1,allowOverwrite:!1,autoFileRenaming:!0,forceSave:!1,fileAllocationMode:"644",checkIntegrity:!1,checksumCheck:!0,checksumAlgorithm:"sha-1",continueOnChecksumError:!1,checkCertificate:!0,caCertificate:"",certificate:"",privateKey:""}),f.success("已恢复为默认安全设置")}catch{}}return(a,e)=>{const h=u("el-alert"),m=u("el-input"),s=u("el-form-item"),d=u("el-switch"),v=u("el-card"),c=u("el-option"),F=u("el-select"),b=u("el-button"),P=u("el-space"),E=u("el-form"),M=D("loading");return g(),K("div",G,[e[37]||(e[37]=i("div",{class:"settings-header"},[i("h2",null,"安全与认证"),i("p",{class:"settings-description"},"配置 RPC 安全、文件安全和完整性检查参数")],-1)),p(n).isConnected?R("",!0):(g(),y(h,{key:0,title:"未连接到 Aria2 服务器",description:"请先连接到 Aria2 服务器才能修改设置",type:"warning",closable:!1,style:{"margin-bottom":"20px"}})),_((g(),y(E,{ref_key:"formRef",ref:x,model:l,"label-width":"200px",style:{"max-width":"800px"},disabled:!p(n).isConnected},{default:o(()=>[t(v,{class:"setting-group"},{header:o(()=>[...e[15]||(e[15]=[i("span",{class:"group-title"},"RPC 安全",-1)])]),default:o(()=>[t(s,{label:"RPC 访问密钥"},{default:o(()=>[t(m,{modelValue:l.rpcSecret,"onUpdate:modelValue":e[0]||(e[0]=r=>l.rpcSecret=r),type:"password",placeholder:"RPC 接口访问密钥","show-password":"",clearable:""},null,8,["modelValue"]),e[16]||(e[16]=i("div",{class:"form-tip"},"设置 RPC 接口的访问密钥，留空表示不需要密钥",-1))]),_:1}),t(s,{label:"RPC 监听所有接口"},{default:o(()=>[t(d,{modelValue:l.rpcListenAll,"onUpdate:modelValue":e[1]||(e[1]=r=>l.rpcListenAll=r)},null,8,["modelValue"]),e[17]||(e[17]=i("div",{class:"form-tip"},"允许从所有网络接口访问 RPC",-1))]),_:1}),t(s,{label:"启用 RPC 授权"},{default:o(()=>[t(d,{modelValue:l.enableRpcForAll,"onUpdate:modelValue":e[2]||(e[2]=r=>l.enableRpcForAll=r)},null,8,["modelValue"]),e[18]||(e[18]=i("div",{class:"form-tip"},"启用 RPC 接口的完整授权检查",-1))]),_:1})]),_:1}),t(v,{class:"setting-group"},{header:o(()=>[...e[19]||(e[19]=[i("span",{class:"group-title"},"文件安全",-1)])]),default:o(()=>[t(s,{label:"允许覆盖文件"},{default:o(()=>[t(d,{modelValue:l.allowOverwrite,"onUpdate:modelValue":e[3]||(e[3]=r=>l.allowOverwrite=r)},null,8,["modelValue"]),e[20]||(e[20]=i("div",{class:"form-tip"},"允许覆盖已存在的文件",-1))]),_:1}),t(s,{label:"自动重命名文件"},{default:o(()=>[t(d,{modelValue:l.autoFileRenaming,"onUpdate:modelValue":e[4]||(e[4]=r=>l.autoFileRenaming=r)},null,8,["modelValue"]),e[21]||(e[21]=i("div",{class:"form-tip"},"当文件已存在时自动重命名新文件",-1))]),_:1}),t(s,{label:"强制保存"},{default:o(()=>[t(d,{modelValue:l.forceSave,"onUpdate:modelValue":e[5]||(e[5]=r=>l.forceSave=r)},null,8,["modelValue"]),e[22]||(e[22]=i("div",{class:"form-tip"},"强制保存文件，即使校验失败",-1))]),_:1}),w.value?R("",!0):(g(),y(s,{key:0,label:"文件权限"},{default:o(()=>[t(m,{modelValue:l.fileAllocationMode,"onUpdate:modelValue":e[6]||(e[6]=r=>l.fileAllocationMode=r),placeholder:"644",style:{width:"200px"}},null,8,["modelValue"]),e[23]||(e[23]=i("div",{class:"form-tip"},"新创建文件的权限模式（八进制）",-1))]),_:1}))]),_:1}),t(v,{class:"setting-group"},{header:o(()=>[...e[24]||(e[24]=[i("span",{class:"group-title"},"完整性检查",-1)])]),default:o(()=>[t(s,{label:"检查文件完整性"},{default:o(()=>[t(d,{modelValue:l.checkIntegrity,"onUpdate:modelValue":e[7]||(e[7]=r=>l.checkIntegrity=r)},null,8,["modelValue"]),e[25]||(e[25]=i("div",{class:"form-tip"},"下载完成后检查文件完整性",-1))]),_:1}),t(s,{label:"启用校验和检查"},{default:o(()=>[t(d,{modelValue:l.checksumCheck,"onUpdate:modelValue":e[8]||(e[8]=r=>l.checksumCheck=r)},null,8,["modelValue"]),e[26]||(e[26]=i("div",{class:"form-tip"},"启用文件校验和检查",-1))]),_:1}),t(s,{label:"校验算法",prop:"checksumAlgorithm"},{default:o(()=>[t(F,{modelValue:l.checksumAlgorithm,"onUpdate:modelValue":e[9]||(e[9]=r=>l.checksumAlgorithm=r),style:{width:"200px"}},{default:o(()=>[t(c,{label:"SHA-1",value:"sha-1"}),t(c,{label:"SHA-224",value:"sha-224"}),t(c,{label:"SHA-256",value:"sha-256"}),t(c,{label:"SHA-384",value:"sha-384"}),t(c,{label:"SHA-512",value:"sha-512"}),t(c,{label:"MD5",value:"md5"}),t(c,{label:"ADLER32",value:"adler32"})]),_:1},8,["modelValue"]),e[27]||(e[27]=i("div",{class:"form-tip"},"文件校验使用的摘要算法",-1))]),_:1}),t(s,{label:"校验失败时继续"},{default:o(()=>[t(d,{modelValue:l.continueOnChecksumError,"onUpdate:modelValue":e[10]||(e[10]=r=>l.continueOnChecksumError=r)},null,8,["modelValue"]),e[28]||(e[28]=i("div",{class:"form-tip"},"校验失败时是否继续下载",-1))]),_:1})]),_:1}),t(v,{class:"setting-group"},{header:o(()=>[...e[29]||(e[29]=[i("span",{class:"group-title"},"证书和加密",-1)])]),default:o(()=>[t(s,{label:"验证 HTTPS 证书"},{default:o(()=>[t(d,{modelValue:l.checkCertificate,"onUpdate:modelValue":e[11]||(e[11]=r=>l.checkCertificate=r)},null,8,["modelValue"]),e[30]||(e[30]=i("div",{class:"form-tip"},"是否验证 HTTPS 服务器证书",-1))]),_:1}),t(s,{label:"CA 证书文件"},{default:o(()=>[t(m,{modelValue:l.caCertificate,"onUpdate:modelValue":e[12]||(e[12]=r=>l.caCertificate=r),placeholder:"CA 证书文件路径"},null,8,["modelValue"]),e[31]||(e[31]=i("div",{class:"form-tip"},"用于验证 HTTPS 证书的 CA 证书文件",-1))]),_:1}),t(s,{label:"客户端证书"},{default:o(()=>[t(m,{modelValue:l.certificate,"onUpdate:modelValue":e[13]||(e[13]=r=>l.certificate=r),placeholder:"客户端证书文件路径"},null,8,["modelValue"]),e[32]||(e[32]=i("div",{class:"form-tip"},"HTTPS 客户端证书文件",-1))]),_:1}),t(s,{label:"私钥文件"},{default:o(()=>[t(m,{modelValue:l.privateKey,"onUpdate:modelValue":e[14]||(e[14]=r=>l.privateKey=r),placeholder:"私钥文件路径"},null,8,["modelValue"]),e[33]||(e[33]=i("div",{class:"form-tip"},"客户端证书的私钥文件",-1))]),_:1})]),_:1}),t(s,{style:{"margin-top":"24px"}},{default:o(()=>[t(P,null,{default:o(()=>[t(b,{type:"primary",onClick:O,loading:C.value,disabled:!p(n).isConnected},{default:o(()=>[...e[34]||(e[34]=[A(" 保存设置 ",-1)])]),_:1},8,["loading","disabled"]),t(b,{onClick:S,disabled:!p(n).isConnected},{default:o(()=>[...e[35]||(e[35]=[A(" 重新加载 ",-1)])]),_:1},8,["disabled"]),t(b,{onClick:U,disabled:!p(n).isConnected},{default:o(()=>[...e[36]||(e[36]=[A(" 恢复默认 ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["model","disabled"])),[[M,k.value]])])}}});const z=j(W,[["__scopeId","data-v-dbc1d7a8"]]);export{z as default};
